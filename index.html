<!DOCTYPE html>
<html lang="de-AT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MA Bunker | Brunz-Rechner 3000</title>
    <style>
        :root {
            --bg-color: #121212;
            --container-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --accent: #ffb703; /* Bier-Farbe */
            --danger: #d00000;
            --safe: #2b9348;
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            background-color: var(--container-bg);
            padding: 20px;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            border: 1px solid #333;
        }

        h1 { text-align: center; color: var(--accent); margin-bottom: 5px; }
        .subtitle { text-align: center; font-size: 0.9em; color: #888; margin-bottom: 20px; }

        label { display: block; margin-top: 15px; font-weight: bold; }
        
        input, select {
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            background: #333;
            border: 1px solid #444;
            color: #fff;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box; /* Fix für Padding */
        }

        button.add-btn {
            background-color: var(--accent);
            color: #000;
            font-weight: bold;
            border: none;
            padding: 15px;
            width: 100%;
            border-radius: 8px;
            margin-top: 20px;
            cursor: pointer;
            font-size: 1.1em;
            text-transform: uppercase;
        }

        button.add-btn:hover { background-color: #ffca3a; }

        .drink-list {
            margin-top: 25px;
            border-top: 1px solid #444;
            padding-top: 10px;
        }

        .drink-item {
            background: #2a2a2a;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
        }

        .delete-btn {
            background: #d00000;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            margin-left: 10px;
        }

        /* GAUGE / ANZEIGE */
        .result-box {
            margin-top: 30px;
            text-align: center;
            background: #000;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #333;
        }

        .percentage { font-size: 3em; font-weight: bold; }
        .status-text { font-size: 1.2em; margin-top: 10px; font-weight: bold; }

        .progress-bar-bg {
            background: #333;
            height: 20px;
            border-radius: 10px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            width: 0%;
            transition: width 0.5s ease, background-color 0.5s ease;
        }

        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.8em;
            color: #666;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Brunz-Rechner 3000</h1>
    <div class="subtitle">MA Bunker Wien | Abt. Flüssigkeitsmanagement</div>

    <div style="background: #252525; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
        <label for="bladderCap">Dein Tankvolumen (ml):</label>
        <select id="bladderCap">
            <option value="300">300ml (Konfirmanden-Blase)</option>
            <option value="500" selected>500ml (Standard Wappla)</option>
            <option value="700">700ml (Bunker-Profi)</option>
            <option value="1000">1000ml (Elefanten-Modus)</option>
        </select>
    </div>

    <label for="drinkType">Was wird gesoffen?</label>
    <select id="drinkType">
        <option value="1.0">Wasser / Kracherl (Faktor 1.0)</option>
        <option value="1.4" selected>Bier / Seidl / Hülse (Faktor 1.4)</option>
        <option value="1.2">Kaffee / Energy (Faktor 1.2)</option>
        <option value="1.6">Schnaps / Harter Alk (Faktor 1.6)</option>
    </select>

    <div style="display: flex; gap: 10px;">
        <div style="flex: 1;">
            <label for="amount">Menge (ml)</label>
            <input type="number" id="amount" value="500" step="50">
        </div>
        <div style="flex: 1;">
            <label for="timeOffset">Wann? (Minuten her)</label>
            <input type="number" id="timeOffset" value="0" min="0">
        </div>
    </div>

    <button class="add-btn" onclick="addDrink()">Rein in den Schlund!</button>

    <div class="result-box">
        <div>Füllstand Blase:</div>
        <div class="percentage" id="percentDisplay">0%</div>
        <div class="progress-bar-bg">
            <div class="progress-bar-fill" id="progressBar"></div>
        </div>
        <div class="status-text" id="statusText">Alles trocken, Oida.</div>
        <div style="font-size: 0.8em; margin-top: 5px; color: #888;">(Aktuell generierter Urin: <span id="mlDisplay">0</span> ml)</div>
    </div>

    <div class="drink-list" id="drinkList">
        </div>

    <div class="footer">
        &copy; 2025 Stefan & Vicky - MA Bunker.<br>
        Nutzung auf eigene Gefahr. Hosenwechsel nicht inkludiert.
    </div>
</div>

<script>
    // State
    let drinks = [];
    const updateInterval = 10000; // Alle 10 sekunden update

    function addDrink() {
        const typeSelect = document.getElementById('drinkType');
        const amountInput = document.getElementById('amount');
        const timeInput = document.getElementById('timeOffset'); // Minuten her

        const factor = parseFloat(typeSelect.value);
        const amount = parseInt(amountInput.value);
        const minsAgo = parseInt(timeInput.value);

        if (!amount || amount <= 0) {
            alert("Oida, gib a Menge ein!");
            return;
        }

        // Wir speichern den absoluten Timestamp wann getrunken wurde
        const now = new Date();
        const drinkTime = new Date(now.getTime() - (minsAgo * 60000));

        const drink = {
            id: Date.now(),
            name: typeSelect.options[typeSelect.selectedIndex].text,
            factor: factor,
            amount: amount,
            time: drinkTime
        };

        drinks.push(drink);
        renderList();
        calculatePee();
        
        // Reset Inputs
        document.getElementById('timeOffset').value = 0;
    }

    function removeDrink(id) {
        drinks = drinks.filter(d => d.id !== id);
        renderList();
        calculatePee();
    }

    function renderList() {
        const list = document.getElementById('drinkList');
        list.innerHTML = '';
        
        // Sortieren: Neueste oben
        const sortedDrinks = [...drinks].sort((a, b) => b.time - a.time);

        sortedDrinks.forEach(d => {
            const timeStr = d.time.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            const item = document.createElement('div');
            item.className = 'drink-item';
            item.innerHTML = `
                <div>
                    <strong>${timeStr}</strong>: ${d.amount}ml (${d.name})
                </div>
                <button class="delete-btn" onclick="removeDrink(${d.id})">X</button>
            `;
            list.appendChild(item);
        });
    }

    function calculatePee() {
        const capacity = parseInt(document.getElementById('bladderCap').value);
        const now = new Date();
        
        let totalUrineInBladder = 0;

        drinks.forEach(d => {
            // Zeitdifferenz in Minuten
            const diffMs = now - d.time;
            const minutesPassed = diffMs / 60000;

            // DER ALGORITHMUS
            // Modell: Nierenverzögerung. 
            // 0-15 Min: Wenig passiert (Magen -> Blut)
            // 15-90 Min: Hauptverarbeitung (Blut -> Niere -> Blase)
            // > 90 Min: Alles durch.
            
            let processedPercentage = 0;

            if (minutesPassed < 15) {
                // Anfluten: 0% bis 10%
                processedPercentage = (minutesPassed / 15) * 0.10; 
            } else if (minutesPassed >= 15 && minutesPassed <= 90) {
                // Hauptphase: Linear von 10% auf 100%
                // (minutesPassed - 15) / 75 mapped 0..1 auf den Restbereich
                processedPercentage = 0.10 + ((minutesPassed - 15) / 75) * 0.90;
            } else {
                processedPercentage = 1.0;
            }

            // Effektive Urinmenge = Menge * Faktor * Fortschritt
            const urineFromThisDrink = d.amount * d.factor * processedPercentage;
            totalUrineInBladder += urineFromThisDrink;
        });

        // UI Updates
        const percentFull = Math.min(100, Math.round((totalUrineInBladder / capacity) * 100));
        const mlDisplay = Math.round(totalUrineInBladder);

        document.getElementById('percentDisplay').innerText = percentFull + "%";
        document.getElementById('mlDisplay').innerText = mlDisplay;

        const bar = document.getElementById('progressBar');
        const text = document.getElementById('statusText');
        
        bar.style.width = percentFull + "%";

        // Farben & Texte (Austrian Style)
        if (percentFull < 40) {
            bar.style.backgroundColor = "var(--safe)";
            text.innerText = "Alles leiwand.";
            text.style.color = "var(--safe)";
        } else if (percentFull < 75) {
            bar.style.backgroundColor = "#ffca3a"; // Gelb
            text.innerText = "Druck auf der Leitung...";
            text.style.color = "#ffca3a";
        } else if (percentFull < 95) {
            bar.style.backgroundColor = "var(--danger)"; // Rot
            text.innerText = "OIDA! Such an Baum!";
            text.style.color = "var(--danger)";
        } else {
            bar.style.backgroundColor = "#800f2f"; // Dunkelrot
            text.innerText = "HOSE NASS / GAME OVER";
            text.style.color = "#ff0000";
        }
    }

    // Loop
    setInterval(calculatePee, 5000); // Check alle 5 sek
    calculatePee(); // Init
</script>

</body>
</html>
